{{ if eq .chezmoi.os "darwin" -}}
#!/bin/bash
set -euo pipefail

# Install Homebrew if not present
if ! command -v brew >/dev/null 2>&1; then
  echo "Installing Homebrew..."
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

echo "Installing packages from Brewfile..."
brew bundle --file="{{ .chezmoi.sourceDir }}/Brewfile"

if ! command -v cargo >/dev/null 2>&1; then
  echo "Installing Rust..."
  /bin/bash -c "$(curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh)"
  source "$HOME/.cargo/env"
fi

cargo install --locked bob-nvim
export PATH="$HOME/.cargo/bin:$PATH"
if command -v bob >/dev/null 2>&1; then
  bob use stable
else
  echo "bob-nvim not found in PATH after install"
fi

cargo install --locked atuin

if [ -d "$HOME/.antidote" ]; then
    echo "Antidote is already installed in $HOME/.antidote"
else
    echo "Installing antidote..."
    git clone --depth=1 https://github.com/mattmc3/antidote.git $HOME/.antidote
    echo "Antidote successfully installed to $HOME/.antidote"
fi

if command -v zsh >/dev/null 2>&1; then
  if [ "$SHELL" != "$(which zsh)" ]; then
    chsh -s "$(which zsh)"
  fi
else
  brew install zsh
  if [ "$SHELL" != "$(which zsh)" ]; then
    chsh -s "$(which zsh)"
  fi
fi

echo "Close and reopen your terminal to apply changes."
{{ else if eq .chezmoi.os "linux" -}}
#!/bin/bash
set -euo pipefail

# Debian/Ubuntu example â€” customize as needed
echo "Updating apt and installing packages..."
sudo apt update
sudo apt install -y software-properties-common curl gnupg apt-transport-https

# For newer tools like bat, eza, etc.
if ! grep -q "^deb .*backports" /etc/apt/sources.list /etc/apt/sources.list.d/*; then
    sudo add-apt-repository -y "deb http://deb.debian.org/debian $(lsb_release -cs)-backports main"
fi

sudo apt update && sudo apt install -y \
  curl \
  fzf \
  git \
  ipython3 \
  jq \
  python3-pip \
  python3-jupytext \
  lua-rocks \
  lua5.4 \
  ripgrep \
  tmux \
  tree-sitter-cli \
  uv \
  visidata \
  zsh 

if ! command -v starship >/dev/null 2>&1; then
    echo "Installing Starship prompt..."
    curl -sS https://starship.rs/install.sh | sh -s -- -y
fi

if ! command -v z >/dev/null 2>&1; then
    echo "Installing Zoxide..."
    curl -sSfL https://raw.githubusercontent.com/ajeetdsouza/zoxide/main/install.sh | sh
fi

if ! command -v cargo >/dev/null 2>&1; then
  echo "Installing Rust..."
  /bin/bash -c "$(curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh)"
  source "$HOME/.cargo/env"

fi


cargo install --locked bob-nvim
export PATH="$HOME/.cargo/bin:$PATH"
if command -v bob >/dev/null 2>&1; then
  bob use stable
else
  echo "bob-nvim not found in PATH after install"
fi

cargo install --locked atuin

if [ -d "$HOME/.antidote" ]; then
    echo "Antidote is already installed in $HOME/.antidote"
else
    echo "Installing antidote..."
    git clone --depth=1 https://github.com/mattmc3/antidote.git $HOME/.antidote
    echo "Antidote successfully installed to $HOME/.antidote"
fi

# Set ZSH as default shell
if command -v zsh >/dev/null 2>&1; then
    if [ "$SHELL" != "$(which zsh)" ]; then
        echo "Changing default shell to zsh..."
        sudo chsh -s "$(which zsh)" "$USER"
    fi
else
    echo "ZSH installation failed, shell not changed"
fi

echo "Close and reopen your terminal to apply changes."
{{ end -}}
